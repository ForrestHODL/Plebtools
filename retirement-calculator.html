<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Retirement Calculator - Plebtools</title>
    <link rel="icon" type="image/x-icon" href="images/bitcoin retro symbol.jpeg">
    <link rel="stylesheet" href="styles.css?v=3">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .calculator-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .calculator-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .calculator-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 1rem;
        }

        .calculator-subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 2rem;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .input-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #333;
        }

        .input-field {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }

        .calculate-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .results-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }

        .summary-card h3 {
            margin: 0 0 0.5rem 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .summary-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 0;
        }

        .table-container {
            margin-top: 2rem;
            overflow-x: auto;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .results-table th,
        .results-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .results-table th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        .results-table tr:hover {
            background: #f8f9fa;
        }

        .chart-container {
            margin-top: 2rem;
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border: 1px solid #f5c6cb;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .calculator-grid {
                grid-template-columns: 1fr;
            }
            
            .calculator-container {
                padding: 1rem;
            }
            
            .input-section,
            .results-section,
            .chart-container {
                padding: 1.5rem;
            }
            
            .summary-cards {
                grid-template-columns: 1fr;
            }
        }

        /* Dark theme support */
        .dark-theme .input-section,
        .dark-theme .results-section,
        .dark-theme .chart-container {
            background: #3d3d3d;
            border-color: #555;
        }

        .dark-theme .input-label {
            color: #e0e0e0;
        }

        .dark-theme .input-field {
            background: #4d4d4d;
            border-color: #555;
            color: #e0e0e0;
        }

        .dark-theme .input-field:focus {
            border-color: #667eea;
        }

        .dark-theme .results-table th {
            background: #4d4d4d;
            color: #e0e0e0;
        }

        .dark-theme .results-table td {
            color: #e0e0e0;
        }

        .dark-theme .results-table tr:hover {
            background: #4d4d4d;
        }

        .dark-theme .calculator-title {
            color: #e0e0e0;
        }

        .dark-theme .calculator-subtitle {
            color: #ccc;
        }

        /* Dropdown styles */
        #toolsDropdown {
            position: relative;
            display: inline-block;
        }
        
        #toolsBtn {
            background: none;
            border: none;
            color: #333;
            font-weight: 500;
            font-size: 1rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .dark-theme #toolsBtn {
            color: #e0e0e0 !important;
        }
        
        #toolsBtn:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }
        
        .dropdown-arrow {
            font-size: 0.8rem;
            transition: transform 0.3s ease;
        }
        
        #toolsContent {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        
        #toolsContent.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        #toolsContent a {
            display: block;
            padding: 0.75rem 1rem;
            color: #333;
            text-decoration: none;
            transition: background-color 0.2s ease;
        }
        
        #toolsContent a:hover {
            background-color: #f8f9fa;
            color: #667eea;
        }
        
        .dark-theme #toolsContent {
            background: #3d3d3d;
            border-color: #555;
        }
        
        .dark-theme #toolsContent a {
            color: #e0e0e0;
        }
        
        .dark-theme #toolsContent a:hover {
            background-color: #4d4d4d;
            color: #667eea;
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="nav-container">
                <div class="logo-container">
                    <img src="images/plub tools image.jpeg" alt="Plebtools" class="nav-logo">
                    <h1 class="logo">Plebtools</h1>
                </div>
                <div class="nav-links">
                    <div class="dropdown" id="toolsDropdown">
                        <button class="dropdown-btn" id="toolsBtn">Tools <span class="dropdown-arrow">‚ñº</span></button>
                        <div class="dropdown-content" id="toolsContent" style="display: none;">
                            <a href="home">üè† Home</a>
                            <a href="treasury">üìä Treasury</a>
                            <a href="btc-buy-tracker">üíº Portfolio</a>
                            <a href="coveredcall-tracker">üìà Covered Calls</a>
                            <a href="compound-interest-calculator">üí∞ Calculator</a>
                            <a href="retirement-calculator">üèñÔ∏è Retirement</a>
                            <a href="btc-loan-ltv">üîí BTC Loans</a>
                            <a href="financial-planner">üìã Financial Planner</a>
                            <a href="bitcoin-security">üõ°Ô∏è Bitcoin Security</a>
                            <a href="pleb-release">üì∞ Pleb Release</a>
                        </div>
                    </div>
                    <a href="account" class="account-link">üë§ Account</a>
                </div>
            </div>
        </nav>
    </header>

    <main>
        <div class="calculator-container">
            <div class="calculator-header">
                <h1 class="calculator-title">Bitcoin Retirement Calculator</h1>
                <p class="calculator-subtitle">
                    Calculate how much Bitcoin you need to retire based on your expenses, 
                    inflation, and Bitcoin appreciation assumptions, and how much Bitcoin you want to pass on to your heirs.
                </p>
            </div>

            <div class="calculator-grid">
                <div class="input-section">
                    <h2>Input Parameters</h2>
                    
                    <div class="input-group">
                        <label class="input-label" for="years">Number of Years (default: 25)</label>
                        <input type="number" id="years" class="input-field" value="25" min="1" max="50">
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="monthlySpend">Monthly Spend ($)</label>
                        <input type="number" id="monthlySpend" class="input-field" value="5000" min="0">
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="inflation">Inflation Rate (%)</label>
                        <input type="number" id="inflation" class="input-field" value="7" min="0" max="20" step="0.1">
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="appreciation">Bitcoin Appreciation Rate (%)</label>
                        <input type="number" id="appreciation" class="input-field" value="15" min="0" max="50" step="0.1">
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="btcPrice">Bitcoin Price at retirement ($)</label>
                        <input type="number" id="btcPrice" class="input-field" value="623197" min="0">
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="startYear">Starting Year</label>
                        <input type="number" id="startYear" class="input-field" value="2032" min="2024" max="2100">
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="remainingBtc">BTC to Pass on</label>
                        <input type="number" id="remainingBtc" class="input-field" value="0" min="0" step="0.001">
                        <small style="color: #666; font-size: 0.9rem;">How much Bitcoin you want to keep after the retirement period ends</small>
                    </div>

                    <button class="calculate-btn" onclick="calculateRetirement()">
                        Calculate Retirement Plan
                    </button>
                </div>

                <div class="results-section">
                    <h2>Results</h2>
                    <div id="loading" class="loading" style="display: none;">
                        Calculating your Bitcoin retirement plan...
                    </div>
                    <div id="error" class="error-message" style="display: none;"></div>
                    <div id="results" style="display: none;">
                        <div class="summary-cards" id="summaryCards"></div>
                        <div class="table-container">
                            <table class="results-table" id="resultsTable"></table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <h2>Financial Progression Chart</h2>
                <canvas id="chart" width="400" height="200"></canvas>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 Plebtools. Open source Bitcoin tracking tools.</p>
        </div>
    </footer>

    <script>
        let chart = null;

        // Fetch current Bitcoin price
        async function fetchBitcoinPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd');
                const data = await response.json();
                return data.bitcoin.usd;
            } catch (error) {
                console.error('Error fetching Bitcoin price:', error);
                return 623197; // Fallback price
            }
        }

        // Calculate balance with skip growth (no growth in year 1)
        function calculateBalanceWithSkipGrowth(assets, years, annualExpenses, inflationRate, appreciationRate, btcPrice, remainingBtc) {
            let balance = assets * btcPrice;
            let currentBtcPrice = btcPrice;
            
            for (let year = 1; year <= years; year++) {
                const expenses = annualExpenses * Math.pow(1 + inflationRate, year - 1);
                
                if (year === 1) {
                    // Skip growth in year 1
                    balance = balance - expenses;
                } else {
                    const assetGrowth = balance * appreciationRate;
                    balance = balance + assetGrowth - expenses;
                    // Update BTC price for this year
                    currentBtcPrice = currentBtcPrice * (1 + appreciationRate);
                }
            }
            
            // The remaining Bitcoin should be worth the final BTC price
            const finalBtcPrice = btcPrice * Math.pow(1 + appreciationRate, years - 1);
            const remainingBtcValue = remainingBtc * finalBtcPrice;
            
            // We want the final balance to be exactly equal to the remaining Bitcoin value
            // So we return the difference (should be 0 when we have the right amount)
            return balance - remainingBtcValue;
        }

        // Find required assets using binary search
        function findRequiredAssets(years, annualExpenses, inflationRate, appreciationRate, btcPrice, remainingBtc) {
            let low = 0.01;
            let high = 1000;
            const tolerance = 0.0001; // More precise tolerance
            
            // Expand search range if needed
            while (calculateBalanceWithSkipGrowth(low, years, annualExpenses, inflationRate, appreciationRate, btcPrice, remainingBtc) * 
                   calculateBalanceWithSkipGrowth(high, years, annualExpenses, inflationRate, appreciationRate, btcPrice, remainingBtc) > 0) {
                low /= 2;
                high *= 2;
                if (low < 1e-8 || high > 1e8) {
                    throw new Error("Could not find a valid bracket containing the root.");
                }
            }
            
            // Binary search
            while (high - low > tolerance) {
                const mid = (low + high) / 2;
                const balance = calculateBalanceWithSkipGrowth(mid, years, annualExpenses, inflationRate, appreciationRate, btcPrice, remainingBtc);
                
                if (balance > 0) {
                    high = mid;
                } else {
                    low = mid;
                }
            }
            
            return (low + high) / 2;
        }

        async function calculateRetirement() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const results = document.getElementById('results');
            
            // Show loading
            loading.style.display = 'block';
            error.style.display = 'none';
            results.style.display = 'none';
            
            try {
                // Get input values
                const years = parseInt(document.getElementById('years').value);
                const monthlySpend = parseFloat(document.getElementById('monthlySpend').value);
                const inflation = parseFloat(document.getElementById('inflation').value) / 100;
                const appreciation = parseFloat(document.getElementById('appreciation').value) / 100;
                const btcPrice = parseFloat(document.getElementById('btcPrice').value);
                const startYear = parseInt(document.getElementById('startYear').value);
                const remainingBtc = parseFloat(document.getElementById('remainingBtc').value);
                
                // Validate inputs
                if (years < 1 || years > 50) {
                    throw new Error('Years must be between 1 and 50');
                }
                if (monthlySpend < 0) {
                    throw new Error('Monthly spend cannot be negative');
                }
                if (inflation < 0 || inflation > 0.2) {
                    throw new Error('Inflation rate must be between 0% and 20%');
                }
                if (appreciation < 0 || appreciation > 0.5) {
                    throw new Error('Appreciation rate must be between 0% and 50%');
                }
                if (btcPrice <= 0) {
                    throw new Error('Bitcoin price must be positive');
                }
                if (remainingBtc < 0) {
                    throw new Error('Remaining Bitcoin cannot be negative');
                }
                
                const annualExpenses = monthlySpend * 12;
                
                // Calculate required assets
                const requiredAssets = findRequiredAssets(years, annualExpenses, inflation, appreciation, btcPrice, remainingBtc);
                const totalCost = requiredAssets * btcPrice;
                
                // Generate table data
                const tableData = [];
                let balance = requiredAssets * btcPrice;
                let btcBalance = requiredAssets; // Track Bitcoin amount
                let currentBtcPrice = btcPrice; // Track current BTC price
                let totalExpenses = 0;
                let totalAppreciation = 0;
                
                for (let year = 1; year <= years; year++) {
                    const expenses = annualExpenses * Math.pow(1 + inflation, year - 1);
                    let assetGrowth = 0;
                    
                    if (year === 1) {
                        // Skip growth in year 1
                        assetGrowth = 0;
                    } else {
                        assetGrowth = balance * appreciation;
                        // Update BTC price for this year (appreciates with the same rate)
                        currentBtcPrice = currentBtcPrice * (1 + appreciation);
                    }
                    
                    const subtotal = balance + assetGrowth;
                    const endingBalance = subtotal - expenses;
                    // Convert expenses to BTC using current BTC price for this year
                    const expensesInBtc = expenses / currentBtcPrice;
                    const endingBtcBalance = btcBalance - expensesInBtc;
                    
                    tableData.push({
                        year: startYear + year - 1,
                        startingBalance: balance,
                        startingBtc: btcBalance,
                        currentBtcPrice: currentBtcPrice,
                        appreciationRate: (appreciation * 100).toFixed(1) + '%',
                        appreciationValue: assetGrowth,
                        subtotal: subtotal,
                        livingExpenses: expenses,
                        expensesInBtc: expensesInBtc,
                        endingBalance: endingBalance,
                        endingBtc: endingBtcBalance
                    });
                    
                    balance = endingBalance;
                    btcBalance = endingBtcBalance;
                    totalExpenses += expenses;
                    totalAppreciation += assetGrowth;
                }
                
                // Add totals row
                tableData.push({
                    year: 'Total',
                    startingBalance: '-',
                    startingBtc: '-',
                    currentBtcPrice: '-',
                    appreciationRate: '-',
                    appreciationValue: totalAppreciation,
                    subtotal: '-',
                    livingExpenses: totalExpenses,
                    expensesInBtc: '-',
                    endingBalance: '-',
                    endingBtc: '-'
                });
                
                // Calculate final values
                const finalBtcPrice = btcPrice * Math.pow(1 + appreciation, years - 1);
                const finalBtcValue = remainingBtc * finalBtcPrice;
                const finalBalance = balance - finalBtcValue;
                
                // The binary search should ensure this is very close to zero
                // If it's significantly negative, there's an error in our calculation
                if (finalBalance < -100) { // Allow for reasonable rounding errors
                    throw new Error(`Calculation error! Final balance is significantly negative ($${finalBalance.toLocaleString()}). This should not happen with the binary search algorithm.`);
                }
                
                // If final balance is slightly negative due to rounding, set it to zero
                const displayFinalBalance = finalBalance < 0 ? 0 : finalBalance;
                if (finalBalance < 0) {
                    console.log(`Adjusting final balance from $${finalBalance.toLocaleString()} to $0 due to rounding`);
                }
                
                // Update summary cards
                const summaryCards = document.getElementById('summaryCards');
                summaryCards.innerHTML = `
                    <div class="summary-card">
                        <h3>Assets Required</h3>
                        <p class="value">${requiredAssets.toFixed(2)} BTC</p>
                    </div>
                    <div class="summary-card">
                        <h3>BTC Price at Retirement</h3>
                        <p class="value">$${btcPrice.toLocaleString()}</p>
                    </div>
                    <div class="summary-card">
                        <h3>Total Cost</h3>
                        <p class="value">$${totalCost.toLocaleString()}</p>
                    </div>
                    <div class="summary-card">
                        <h3>BTC to Pass on</h3>
                        <p class="value">${remainingBtc.toFixed(8)} BTC</p>
                    </div>
                    <div class="summary-card">
                        <h3>Final Balance</h3>
                        <p class="value">$${displayFinalBalance.toLocaleString()}</p>
                    </div>
                `;
                
                // Update table
                const table = document.getElementById('resultsTable');
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Starting Balance ($)</th>
                            <th>Starting BTC</th>
                            <th>BTC Price ($)</th>
                            <th>Appreciation Rate</th>
                            <th>Appreciation Value ($)</th>
                            <th>Subtotal ($)</th>
                            <th>Living Expenses ($)</th>
                            <th>Expenses (BTC)</th>
                            <th>Ending Balance ($)</th>
                            <th>Ending BTC</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${tableData.map(row => `
                            <tr>
                                <td>${row.year}</td>
                                <td>${typeof row.startingBalance === 'number' ? '$' + row.startingBalance.toLocaleString() : row.startingBalance}</td>
                                <td>${typeof row.startingBtc === 'number' ? row.startingBtc.toFixed(8) : row.startingBtc}</td>
                                <td>${typeof row.currentBtcPrice === 'number' ? '$' + row.currentBtcPrice.toLocaleString() : row.currentBtcPrice}</td>
                                <td>${row.appreciationRate}</td>
                                <td>${typeof row.appreciationValue === 'number' ? '$' + row.appreciationValue.toLocaleString() : row.appreciationValue}</td>
                                <td>${typeof row.subtotal === 'number' ? '$' + row.subtotal.toLocaleString() : row.subtotal}</td>
                                <td>${typeof row.livingExpenses === 'number' ? '$' + row.livingExpenses.toLocaleString() : row.livingExpenses}</td>
                                <td>${typeof row.expensesInBtc === 'number' ? row.expensesInBtc.toFixed(8) : row.expensesInBtc}</td>
                                <td>${typeof row.endingBalance === 'number' ? '$' + row.endingBalance.toLocaleString() : row.endingBalance}</td>
                                <td>${typeof row.endingBtc === 'number' ? row.endingBtc.toFixed(8) : row.endingBtc}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                `;
                
                // Update chart
                updateChart(tableData.slice(0, -1)); // Exclude totals row
                
                // Show results
                loading.style.display = 'none';
                results.style.display = 'block';
                
            } catch (err) {
                loading.style.display = 'none';
                error.style.display = 'block';
                error.textContent = err.message;
            }
        }

        function updateChart(data) {
            const ctx = document.getElementById('chart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(row => row.year),
                    datasets: [{
                        label: 'Starting Balance',
                        data: data.map(row => row.startingBalance),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Ending Balance',
                        data: data.map(row => row.endingBalance),
                        borderColor: '#764ba2',
                        backgroundColor: 'rgba(118, 75, 162, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Financial Progression Over Time'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        // Load current Bitcoin price on page load
        window.addEventListener('load', async () => {
            try {
                const currentPrice = await fetchBitcoinPrice();
                document.getElementById('btcPrice').value = currentPrice;
            } catch (error) {
                console.error('Failed to load current Bitcoin price:', error);
            }
        });

        // --- Dropdown Functionality ---
        const toolsBtn = document.getElementById('toolsBtn');
        const toolsContent = document.getElementById('toolsContent');
        let isOpen = false;

        toolsBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            if (isOpen) {
                toolsContent.classList.remove('show');
                setTimeout(() => {
                    toolsContent.style.display = 'none';
                }, 300);
                isOpen = false;
            } else {
                toolsContent.style.display = 'block';
                setTimeout(() => {
                    toolsContent.classList.add('show');
                }, 10);
                isOpen = true;
            }
        });

        // Close when clicking outside
        document.addEventListener('click', function(e) {
            if (!document.getElementById('toolsDropdown').contains(e.target)) {
                toolsContent.classList.remove('show');
                setTimeout(() => {
                    toolsContent.style.display = 'none';
                }, 300);
                isOpen = false;
            }
        });

        // Theme toggle functionality
        const themeToggle = document.createElement('button');
        themeToggle.innerHTML = 'üåô';
        themeToggle.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 1.5rem;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        `;

        let isDarkTheme = false;

        themeToggle.addEventListener("click", () => {
            isDarkTheme = !isDarkTheme;
            if (isDarkTheme) {
                document.body.classList.add("dark-theme");
                themeToggle.textContent = "‚òÄÔ∏è";
                localStorage.setItem("theme", "dark");
            } else {
                document.body.classList.remove("dark-theme");
                themeToggle.textContent = "üåô";
                localStorage.setItem("theme", "light");
            }
        });

        // Load saved theme on page load
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme === "dark") {
            isDarkTheme = true;
            document.body.classList.add("dark-theme");
            themeToggle.textContent = "‚òÄÔ∏è";
        }

        document.body.appendChild(themeToggle);
    </script>
</body>
</html>
